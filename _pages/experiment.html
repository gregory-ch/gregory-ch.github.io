---
layout: single
title: "Experiment"
permalink: /experiment/
author_profile: true
---

<div class="experiment-container" style="text-align: center; padding: 20px;">
    <button id="createSession" style="padding: 10px 20px; font-size: 16px; cursor: pointer; background-color: #0366d6; color: white; border: none; border-radius: 4px;">Start Experiment</button>
    <div id="result" style="margin-top: 20px;"></div>
    <div id="debug" style="margin-top: 20px; text-align: left; padding: 10px; background: #f5f5f5; border-radius: 4px;"></div>
</div>

<script>
document.getElementById('createSession').onclick = async function() {
    const button = this;
    const result = document.getElementById('result');
    const debug = document.getElementById('debug');
    
    button.disabled = true;
    result.innerHTML = 'Creating session...';
    debug.innerHTML = 'Starting request...<br>';

    try {
        // Сначала проверим OPTIONS
        debug.innerHTML += 'Sending OPTIONS request...<br>';
        const preflightResponse = await fetch('https://belabeu-e7061ee8ef78.herokuapp.com/api/sessions/', {
            method: 'OPTIONS',
            headers: {
                'Access-Control-Request-Method': 'POST',
                'Access-Control-Request-Headers': 'content-type, otree-rest-key'
            }
        });
        debug.innerHTML += `OPTIONS status: ${preflightResponse.status}<br>`;
        debug.innerHTML += `OPTIONS headers: ${JSON.stringify(Object.fromEntries(preflightResponse.headers.entries()), null, 2)}<br>`;

        // Основной запрос
        debug.innerHTML += 'Sending POST request...<br>';
        const response = await fetch('https://belabeu-e7061ee8ef78.herokuapp.com/api/sessions/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'otree-rest-key': '125exp125exp'
            },
            body: JSON.stringify({
                "session_config_name": "dsst",
                "num_participants": 1,
                "room_name": "live_demo"
            })
        });
        
        debug.innerHTML += `POST status: ${response.status}<br>`;
        debug.innerHTML += `POST headers: ${JSON.stringify(Object.fromEntries(response.headers.entries()), null, 2)}<br>`;

        const data = await response.json();
        debug.innerHTML += `Response data: ${JSON.stringify(data, null, 2)}<br>`;
        
        if (response.ok && data.session_wide_url) {
            window.location.href = data.session_wide_url;
        } else {
            result.innerHTML = 'Error creating session. Please try again.';
        }
    } catch (error) {
        result.innerHTML = 'Error connecting to server. Please try again.';
        debug.innerHTML += `Error: ${error.toString()}<br>`;
        debug.innerHTML += `Stack: ${error.stack || 'No stack trace'}<br>`;
    } finally {
        button.disabled = false;
    }
};
</script> 