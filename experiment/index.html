<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"> <!-- begin SEO --><title>Experiment - About</title><meta property="og:locale" content="en-US"><meta property="og:site_name" content="About"><meta property="og:title" content="Experiment"><link rel="canonical" href="https://gregory-ch.github.io/experiment/"><meta property="og:url" content="https://gregory-ch.github.io/experiment/"> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "Person", "name" : "Chernov Gregory", "url" : "https://gregory-ch.github.io", "sameAs" : null } </script> <!-- end SEO --><link href="https://gregory-ch.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="About Feed"> <!-- http://t.co/dKP3o1e --><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width, initial-scale=1.0"> <script> document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js '; </script> <!-- For all browsers --><link rel="stylesheet" href="https://gregory-ch.github.io/assets/css/main.css"><meta http-equiv="cleartype" content="on"> <!-- start custom head snippets --><link rel="apple-touch-icon" sizes="57x57" href="https://gregory-ch.github.io/images/apple-touch-icon-57x57.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="60x60" href="https://gregory-ch.github.io/images/apple-touch-icon-60x60.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="72x72" href="https://gregory-ch.github.io/images/apple-touch-icon-72x72.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="76x76" href="https://gregory-ch.github.io/images/apple-touch-icon-76x76.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="114x114" href="https://gregory-ch.github.io/images/apple-touch-icon-114x114.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="120x120" href="https://gregory-ch.github.io/images/apple-touch-icon-120x120.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="144x144" href="https://gregory-ch.github.io/images/apple-touch-icon-144x144.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="152x152" href="https://gregory-ch.github.io/images/apple-touch-icon-152x152.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="180x180" href="https://gregory-ch.github.io/images/apple-touch-icon-180x180.png?v=M44lzPylqQ"><link rel="icon" type="image/png" href="https://gregory-ch.github.io/images/favicon-32x32.png?v=M44lzPylqQ" sizes="32x32"><link rel="icon" type="image/png" href="https://gregory-ch.github.io/images/android-chrome-192x192.png?v=M44lzPylqQ" sizes="192x192"><link rel="icon" type="image/png" href="https://gregory-ch.github.io/images/favicon-96x96.png?v=M44lzPylqQ" sizes="96x96"><link rel="icon" type="image/png" href="https://gregory-ch.github.io/images/favicon-16x16.png?v=M44lzPylqQ" sizes="16x16"><link rel="manifest" href="https://gregory-ch.github.io/images/manifest.json?v=M44lzPylqQ"><link rel="mask-icon" href="https://gregory-ch.github.io/images/safari-pinned-tab.svg?v=M44lzPylqQ" color="#000000"><link rel="shortcut icon" href="/images/favicon.ico?v=M44lzPylqQ"><meta name="msapplication-TileColor" content="#000000"><meta name="msapplication-TileImage" content="https://gregory-ch.github.io/images/mstile-144x144.png?v=M44lzPylqQ"><meta name="msapplication-config" content="https://gregory-ch.github.io/images/browserconfig.xml?v=M44lzPylqQ"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="https://gregory-ch.github.io/assets/css/academicons.css"/> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } }); </script> <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script> <!-- end custom head snippets --></head><body> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav"><div class="menu-button"> <span></span> <span></span> <span></span></div><ul class="visible-links"><li class="masthead__menu-item masthead__menu-item--lg"><a href="https://gregory-ch.github.io/">About</a></li><li class="masthead__menu-item"><a href="https://gregory-ch.github.io/publications/">Publications</a></li><li class="masthead__menu-item"><a href="https://gregory-ch.github.io/talks/">Talks</a></li><li class="masthead__menu-item"><a href="https://gregory-ch.github.io/blog/">Blog</a></li><li class="masthead__menu-item"><a href="https://gregory-ch.github.io/cv/">CV</a></li></ul><ul class="hidden-links hidden"></ul></nav></div></div></div><script> document.querySelector('.menu-button').addEventListener('click', function() { this.classList.toggle('active'); document.querySelector('.visible-links').classList.toggle('show'); }); </script><div id="main" role="main"><div class="sidebar sticky"><div itemscope itemtype="http://schema.org/Person"><div class="author__avatar"> <img src="https://gregory-ch.github.io/images/profile.png" class="author__avatar" alt="Chernov Gregory"></div><div class="author__content"><h3 class="author__name">Chernov Gregory</h3><p class="author__bio">Behavioral scientist, now researcher in UCL</p></div><div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button><ul class="author__urls social-icons"><li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> London</li><li><a href="https://twitter.com/de_marcacio"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li><li><a href="https://www.linkedin.com/in/gregory-ch/"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li><li><a href="https://github.com/gregory-ch"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li></ul></div></div></div><article class="page" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="headline" content="Experiment"><div class="page__inner-wrap"><header><h1 class="page__title" itemprop="headline">Experiment</h1></header><section class="page__content" itemprop="text"><style> body { overflow: auto; } .loading-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; } .spinner { border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 20px; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } .debug-info { position: fixed; bottom: 10px; right: 10px; padding: 10px; background-color: rgba(0, 0, 0, 0.7); color: white; font-size: 12px; max-width: 300px; max-height: 200px; overflow: auto; z-index: 1001; border-radius: 5px; display: none; }</style><div style="text-align: center; padding: 20px;"><div id="frameContainer" style="height: 1400px; overflow: auto; position: relative; width: 800px; margin: 0 auto;"><div id="loadingOverlay" class="loading-overlay"><div class="spinner"></div><p>Loading experiment...</p><p id="status">Initialising connection to server...</p></div><iframe id="experimentFrame" style="width: 800px; height: 2000px; border: none; border-radius: 4px; position: absolute; top: 0; left: 0;" ></iframe></div><div id="debugInfo" class="debug-info"></div></div><script> // Включить режим отладки const DEBUG = true; // Функция для добавления отладочных сообщений function debug(message) { if (DEBUG) { const debugInfo = document.getElementById('debugInfo'); debugInfo.style.display = 'block'; const timestamp = new Date().toLocaleTimeString(); debugInfo.innerHTML += `<div>${timestamp}: ${message}</div>`; debugInfo.scrollTop = debugInfo.scrollHeight; console.log(`DEBUG: ${message}`); } } // Функция для извлечения session code function extractSessionCode(text) { const match = text.match(/SessionStartLinks\/([a-z0-9]+)"/); if (match) { debug('Found session code: ' + match[1]); return match[1]; } return null; } // Функция для поиска session-wide link на странице function findSessionWideLink(html) { // Ищем ссылку формата https://belabeu-e7061ee8ef78.herokuapp.com/join/xxxxx // Более точное регулярное выражение для поиска const joinLinkMatch = html.match(/https:\/\/belabeu-e7061ee8ef78\.herokuapp\.com\/join\/([a-z0-9]+)/); if (joinLinkMatch) { debug('Found session-wide link: ' + joinLinkMatch[0]); return joinLinkMatch[0]; } return null; } // Функция для обновления статуса function updateStatus(message) { const statusElement = document.getElementById('status'); statusElement.textContent = message; debug('Status update: ' + message); } document.addEventListener('DOMContentLoaded', () => { debug('DOM loaded, starting experiment'); const frame = document.getElementById('experimentFrame'); const loadingOverlay = document.getElementById('loadingOverlay'); // Инициализируем пустой iframe frame.src = "about:blank"; // Задержка для наблюдения за интерфейсом oTree и клика по ссылке function tryClickSessionWideLink() { try { debug('Attempting to find and click session-wide link in iframe'); const iframeDoc = frame.contentDocument || frame.contentWindow.document; // Проверяем все ссылки на странице const allLinks = iframeDoc.querySelectorAll('a'); debug(`Found ${allLinks.length} links in iframe`); for (const link of allLinks) { debug(`Link text: "${link.textContent}", href: "${link.href}"`); // Проверяем ссылку на session-wide demo if (link.textContent.includes('Session-wide demo link') || link.href.includes('/join/') || link.parentElement.textContent.includes('Session-wide demo link')) { debug('Found target link! Clicking...'); link.click(); // Имитируем клик по ссылке updateStatus('Clicking on Session-wide demo link...'); return true; } } // Ищем конкретно по тексту на странице const sessionWideText = iframeDoc.body.innerHTML.indexOf('Session-wide demo link'); if (sessionWideText > -1) { debug('Found Session-wide text but could not click link directly'); // Извлекаем URL из HTML вокруг этого текста const htmlAroundLink = iframeDoc.body.innerHTML.substring(sessionWideText - 200, sessionWideText + 200); const extractedUrl = findSessionWideLink(htmlAroundLink); if (extractedUrl) { debug('Extracted URL from HTML: ' + extractedUrl); frame.src = extractedUrl; return true; } } debug('Could not find or click session-wide link'); return false; } catch (e) { debug('Error in tryClickSessionWideLink: ' + e.message); return false; } } // Функция для перехода к эксперименту function navigateToExperiment() { debug('Starting experiment navigation'); // Сначала загружаем страницу с демо frame.src = 'https://belabeu-e7061ee8ef78.herokuapp.com/demo/dsst?test=1'; updateStatus('Loading demo page...'); // После загрузки фрейма пытаемся найти и кликнуть по нужной ссылке frame.onload = function() { debug('Demo page loaded in iframe'); // Проверяем URL - если уже перешли к эксперименту, показываем его if (frame.src.includes('/join/') || frame.src.includes('SessionStartLinks')) { debug('Already redirected to experiment'); updateStatus('Experiment loaded successfully'); loadingOverlay.style.display = 'none'; return; } // Пробуем найти ссылку в iframe и кликнуть по ней const clickSuccess = tryClickSessionWideLink(); // Если не смогли кликнуть, пробуем альтернативный метод через fetch if (!clickSuccess) { debug('Click failed, trying fetch method'); fetch('https://belabeu-e7061ee8ef78.herokuapp.com/demo/dsst?test=1', { method: 'GET', credentials: 'include', headers: { 'Accept': 'text/html' } }) .then(response => { debug('Fetch response status: ' + response.status); if (response.ok) { return response.text(); } else { throw new Error('Fetch failed: ' + response.status); } }) .then(html => { debug('Fetch response received, length: ' + html.length); // Ищем session-wide link в ответе const sessionWideLink = findSessionWideLink(html); if (sessionWideLink) { debug('Found session-wide link in fetch response'); updateStatus('Found experiment link, starting...'); frame.src = sessionWideLink; } else { debug('No session-wide link found in fetch response'); // Если не нашли, пробуем извлечь session code const sessionCode = extractSessionCode(html); if (sessionCode) { debug('Found session code in fetch response'); updateStatus('Found session code, starting experiment...'); frame.src = `https://belabeu-e7061ee8ef78.herokuapp.com/SessionStartLinks/${sessionCode}`; } else { debug('No session code found either, setting manual timeout'); // Если и это не помогло, устанавливаем таймаут для повторной попытки клика setTimeout(() => { debug('Timeout elapsed, trying click again'); if (!tryClickSessionWideLink()) { debug('All methods failed, showing demo page'); loadingOverlay.style.display = 'none'; } }, 2000); } } }) .catch(error => { debug('Fetch error: ' + error.message); // В случае ошибки, просто оставляем демо страницу loadingOverlay.style.display = 'none'; }); } }; } // Запускаем навигацию к эксперименту navigateToExperiment(); // Дополнительный обработчик загрузки iframe frame.addEventListener('load', () => { debug('Frame load event triggered: ' + frame.src); // Если страница загрузилась и это ссылка на эксперимент if (frame.src !== 'about:blank' && (frame.src.includes('/join/') || frame.src.includes('SessionStartLinks'))) { debug('Experiment URL detected, hiding overlay'); updateStatus('Experiment loaded successfully'); loadingOverlay.style.display = 'none'; // Если это режим split screen, корректируем высоту if (frame.src.includes('SessionSplitScreen')) { debug('Split screen mode detected, adjusting height'); frame.style.height = '1800px'; frame.style.top = '-900.5px'; } } }); // Слушаем сообщения от iframe (для CORS коммуникации) window.addEventListener('message', function(event) { // Проверяем источник сообщения if (event.origin === "https://belabeu-e7061ee8ef78.herokuapp.com") { debug('Got message from iframe: ' + JSON.stringify(event.data)); // Если получили URL или статус ready, скрываем оверлей загрузки if (event.data && (event.data.status === 'ready' || event.data.location)) { debug('Received ready status from iframe'); loadingOverlay.style.display = 'none'; } } }); }); </script></section><footer class="page__meta"></footer></div></article></div><!--<div class="page__footer-follow"><ul class="social-icons"><li><strong>Follow:</strong></li><li><a href="http://github.com/gregory-ch"><i class="fab fa-github" aria-hidden="true"></i> GitHub</a></li><li><a href="https://gregory-ch.github.io/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li></ul></div><div class="page__footer-copyright">&copy; 2025 Chernov Gregory. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/academicpages/academicpages.github.io">AcademicPages</a>, a fork of <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>--> <script src="https://gregory-ch.github.io/assets/js/main.min.js"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', '', 'auto'); ga('send', 'pageview'); </script></body></html>
