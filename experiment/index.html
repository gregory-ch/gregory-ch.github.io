<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"> <!-- begin SEO --><title>Experiment - About</title><meta property="og:locale" content="en-US"><meta property="og:site_name" content="About"><meta property="og:title" content="Experiment"><link rel="canonical" href="https://gregory-ch.github.io/experiment/"><meta property="og:url" content="https://gregory-ch.github.io/experiment/"> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "Person", "name" : "Chernov Gregory", "url" : "https://gregory-ch.github.io", "sameAs" : null } </script> <!-- end SEO --><link href="https://gregory-ch.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="About Feed"> <!-- http://t.co/dKP3o1e --><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width, initial-scale=1.0"> <script> document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js '; </script> <!-- For all browsers --><link rel="stylesheet" href="https://gregory-ch.github.io/assets/css/main.css"><meta http-equiv="cleartype" content="on"> <!-- start custom head snippets --><link rel="apple-touch-icon" sizes="57x57" href="https://gregory-ch.github.io/images/apple-touch-icon-57x57.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="60x60" href="https://gregory-ch.github.io/images/apple-touch-icon-60x60.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="72x72" href="https://gregory-ch.github.io/images/apple-touch-icon-72x72.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="76x76" href="https://gregory-ch.github.io/images/apple-touch-icon-76x76.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="114x114" href="https://gregory-ch.github.io/images/apple-touch-icon-114x114.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="120x120" href="https://gregory-ch.github.io/images/apple-touch-icon-120x120.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="144x144" href="https://gregory-ch.github.io/images/apple-touch-icon-144x144.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="152x152" href="https://gregory-ch.github.io/images/apple-touch-icon-152x152.png?v=M44lzPylqQ"><link rel="apple-touch-icon" sizes="180x180" href="https://gregory-ch.github.io/images/apple-touch-icon-180x180.png?v=M44lzPylqQ"><link rel="icon" type="image/png" href="https://gregory-ch.github.io/images/favicon-32x32.png?v=M44lzPylqQ" sizes="32x32"><link rel="icon" type="image/png" href="https://gregory-ch.github.io/images/android-chrome-192x192.png?v=M44lzPylqQ" sizes="192x192"><link rel="icon" type="image/png" href="https://gregory-ch.github.io/images/favicon-96x96.png?v=M44lzPylqQ" sizes="96x96"><link rel="icon" type="image/png" href="https://gregory-ch.github.io/images/favicon-16x16.png?v=M44lzPylqQ" sizes="16x16"><link rel="manifest" href="https://gregory-ch.github.io/images/manifest.json?v=M44lzPylqQ"><link rel="mask-icon" href="https://gregory-ch.github.io/images/safari-pinned-tab.svg?v=M44lzPylqQ" color="#000000"><link rel="shortcut icon" href="/images/favicon.ico?v=M44lzPylqQ"><meta name="msapplication-TileColor" content="#000000"><meta name="msapplication-TileImage" content="https://gregory-ch.github.io/images/mstile-144x144.png?v=M44lzPylqQ"><meta name="msapplication-config" content="https://gregory-ch.github.io/images/browserconfig.xml?v=M44lzPylqQ"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="https://gregory-ch.github.io/assets/css/academicons.css"/> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } }); </script> <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script> <!-- end custom head snippets --></head><body> <!--[if lt IE 9]><div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--><div class="masthead"><div class="masthead__inner-wrap"><div class="masthead__menu"><nav id="site-nav" class="greedy-nav"><div class="menu-button"> <span></span> <span></span> <span></span></div><ul class="visible-links"><li class="masthead__menu-item masthead__menu-item--lg"><a href="https://gregory-ch.github.io/">About</a></li><li class="masthead__menu-item"><a href="https://gregory-ch.github.io/publications/">Publications</a></li><li class="masthead__menu-item"><a href="https://gregory-ch.github.io/talks/">Talks</a></li><li class="masthead__menu-item"><a href="https://gregory-ch.github.io/blog/">Blog</a></li><li class="masthead__menu-item"><a href="https://gregory-ch.github.io/cv/">CV</a></li></ul><ul class="hidden-links hidden"></ul></nav></div></div></div><script> document.querySelector('.menu-button').addEventListener('click', function() { this.classList.toggle('active'); document.querySelector('.visible-links').classList.toggle('show'); }); </script><div id="main" role="main"><div class="sidebar sticky"><div itemscope itemtype="http://schema.org/Person"><div class="author__avatar"> <img src="https://gregory-ch.github.io/images/profile.png" class="author__avatar" alt="Chernov Gregory"></div><div class="author__content"><h3 class="author__name">Chernov Gregory</h3><p class="author__bio">Behavioral scientist, now researcher in UCL</p></div><div class="author__urls-wrapper"> <button class="btn btn--inverse">Follow</button><ul class="author__urls social-icons"><li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> London</li><li><a href="https://twitter.com/de_marcacio"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li><li><a href="https://www.linkedin.com/in/gregory-ch/"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li><li><a href="https://github.com/gregory-ch"><i class="fab fa-fw fa-github" aria-hidden="true"></i> Github</a></li></ul></div></div></div><article class="page" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="headline" content="Experiment"><div class="page__inner-wrap"><header><h1 class="page__title" itemprop="headline">Experiment</h1></header><section class="page__content" itemprop="text"><style> body { overflow: auto; } .experiment-container { text-align: center; max-width: 800px; margin: 30px auto; padding: 30px; background-color: #f9f9f9; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); } .experiment-button { background-color: #3498db; color: white; border: none; padding: 15px 30px; margin: 20px 0; font-size: 18px; font-weight: bold; border-radius: 6px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: inline-block; text-decoration: none; } .experiment-button:hover { background-color: #2980b9; transform: translateY(-2px); box-shadow: 0 6px 8px rgba(0,0,0,0.15); } .success-button { background-color: #2ecc71; } .success-button:hover { background-color: #27ae60; } .info-block { background-color: #f8f9fa; border-left: 4px solid #3498db; padding: 20px; margin: 20px 0; font-size: 16px; line-height: 1.6; text-align: left; } .explanation { text-align: left; margin: 20px 0; line-height: 1.6; } #status { margin-top: 15px; padding: 10px; font-style: italic; color: #666; } .loading { display: inline-block; margin-left: 5px; animation: spin 1.5s linear infinite; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } #experiment-iframe { width: 100%; height: 600px; border: 1px solid #ddd; border-radius: 8px; margin-top: 20px; display: none; } #link-container { margin: 20px 0; padding: 15px; border: 2px dashed #3498db; border-radius: 6px; background-color: #f0f8ff; display: none; } .session-link { color: #2980b9; font-weight: bold; word-break: break-all; display: block; margin: 10px 0; } .debug-panel { margin: 20px 0; padding: 15px; border: 2px solid #f39c12; border-radius: 6px; background-color: #fffaed; text-align: left; display: none; } .debug-button { background-color: #f39c12; margin: 10px 0; } .debug-button:hover { background-color: #e67e22; } .debug-actions { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; } .debug-download { background-color: #34495e; } .debug-download:hover { background-color: #2c3e50; } pre { background-color: #2d2d2d; color: #f8f8f8; font-family: monospace; padding: 10px; border-radius: 4px; margin-top: 10px; max-height: 300px; overflow: auto; font-size: 14px; } .error-message { color: #e74c3c; font-weight: bold; padding: 10px; background-color: #fde2e2; border-radius: 4px; margin: 10px 0; display: none; }</style><div class="experiment-container"><h2>oTree Experiment</h2><div class="explanation"><p>This page allows you to access an oTree experiment hosted on Heroku. Click the button below to automatically generate a session link:</p></div><button id="generate-button" class="experiment-button">Generate Session Link</button><div id="status"></div><div class="error-message" id="error-message"></div><div id="link-container"><p>Your experiment session is ready:</p><a id="session-link" href="#" target="_blank" class="session-link"></a> <button id="open-session" class="experiment-button success-button">Open in New Tab</button> <button id="embed-session" class="experiment-button">Load in Iframe Below</button></div><iframe id="experiment-iframe" src="about:blank"></iframe><div class="info-block"><h3>How it works</h3><p>When you click the button above:</p><ol><li>A request is sent to the oTree server to create a new experiment session</li><li>The server response is analyzed to extract the session-wide link</li><li>The session link is displayed for you to access the experiment</li></ol></div><button id="toggle-debug" class="experiment-button debug-button">Show Debug Information</button><div id="debug-panel" class="debug-panel"><h3>Debug Information</h3><div class="debug-actions"> <button id="xhr-test" class="experiment-button">Test XMLHttpRequest</button> <button id="fetch-test" class="experiment-button">Test Fetch API</button> <button id="download-logs" class="experiment-button debug-download">Download Debug Logs</button> <button id="clear-logs" class="experiment-button">Clear Logs</button></div><h4>Console Output:</h4><pre id="debug-output">// Debug information will appear here</pre></div></div><script> // Переменная для хранения вывода отладки let debugLines = []; // Функция для добавления отладочной информации function debugLog(message, type = 'info') { const time = new Date().toLocaleTimeString(); const logMessage = `[${time}] [${type.toUpperCase()}] ${message}`; // Добавить сообщение в массив debugLines.push(logMessage); // Ограничиваем количество сообщений для производительности if (debugLines.length > 100) { debugLines.shift(); } // Обновляем вывод отладки const debugOutput = document.getElementById('debug-output'); if (debugOutput) { debugOutput.textContent = debugLines.join('\n'); debugOutput.scrollTop = debugOutput.scrollHeight; } // Выводим в консоль браузера с форматированием const consoleStyles = { 'info': 'color: #3498db; font-weight: bold;', 'success': 'color: #2ecc71; font-weight: bold;', 'warn': 'color: #f39c12; font-weight: bold;', 'error': 'color: #e74c3c; font-weight: bold;' }; const style = consoleStyles[type] || consoleStyles.info; // Добавляем значок для лучшей видимости в консоли const icons = { 'info': 'ℹ️', 'success': '✅', 'warn': '⚠️', 'error': '❌' }; const icon = icons[type] || icons.info; // Выводим с форматированием в консоль console.log(`%c${icon} ${time} [${type.toUpperCase()}]`, style, message); // Для ошибок и предупреждений дополнительно используем соответствующие методы консоли if (type === 'error') { console.error(message); } else if (type === 'warn') { console.warn(message); } // Возвращаем сообщение для возможности цепочки вызовов return message; } // Функция для показа сообщения об ошибке пользователю function showError(message) { const errorElement = document.getElementById('error-message'); errorElement.textContent = message; errorElement.style.display = 'block'; debugLog(message, 'error'); } // Функция для обновления статуса function updateStatus(message, isLoading = false) { const statusEl = document.getElementById('status'); if (isLoading) { statusEl.innerHTML = message + ' <span class="loading">⟳</span>'; } else { statusEl.textContent = message; } debugLog(message); } // Функция для извлечения ссылки на сессию из HTML function extractSessionLink(html) { debugLog('Analyzing response to find session link...', 'info'); // Выводим часть HTML для отладки с форматированием debugLog(`Response length: ${html.length} characters`, 'info'); debugLog(`Response preview: ${html.substring(0, 200).replace(/</g, '&lt;').replace(/>/g, '&gt;')}...`, 'info'); // Добавляем полный HTML в консоль для более детального анализа console.log('Full HTML response:', html); try { // Шаблон 1: Session-wide demo link с href атрибутом let pattern = /href=["']([^"']*\/room\/[^"']*)["'][^>]*>Session-wide demo link/i; let match = html.match(pattern); if (match && match[1]) { debugLog(`Found session-wide demo link: ${match[1]}`, 'success'); return match[1]; } // Шаблон 2: join ссылки pattern = /https:\/\/belabeu-e7061ee8ef78\.herokuapp\.com\/join\/([a-z0-9]+)/i; match = html.match(pattern); if (match && match[0]) { debugLog(`Found join link: ${match[0]}`, 'success'); return match[0]; } // Шаблон 3: room ссылки pattern = /https:\/\/belabeu-e7061ee8ef78\.herokuapp\.com\/room\/([a-z0-9]+)/i; match = html.match(pattern); if (match && match[0]) { debugLog(`Found room link: ${match[0]}`, 'success'); return match[0]; } // Шаблон 4: Session start ссылки pattern = /SessionStartLinks\/([a-z0-9]+)/i; match = html.match(pattern); if (match && match[1]) { const fullLink = `https://belabeu-e7061ee8ef78.herokuapp.com/SessionStartLinks/${match[1]}`; debugLog(`Found session start link: ${fullLink}`, 'success'); return fullLink; } // Шаблон 5: Поиск всех ссылок с определенными ключевыми словами debugLog('Checking all links in the response...', 'info'); pattern = /<a[^>]*href=["']([^"']*)["'][^>]*>([^<]*)<\/a>/gi; const links = []; while ((match = pattern.exec(html)) !== null) { const href = match[1]; const text = match[2]; links.push({ href, text }); debugLog(`Found link: ${href} (text: ${text})`, 'info'); } // Выводим все найденные ссылки в консоль для анализа console.table(links); // Ищем подходящую ссылку среди всех найденных const experimentLink = links.find(link => link.href.includes('/join/') || link.href.includes('/room/') || link.href.includes('SessionStartLinks') || link.text.includes('Session-wide') || link.text.includes('demo') ); if (experimentLink) { debugLog(`Selected link based on text/href match: ${experimentLink.href}`, 'success'); return experimentLink.href; } debugLog('No session link found in the response using regular patterns', 'warn'); // Попробуем отчаянный поиск любых URL в тексте debugLog('Attempting desperate search for any relevant URLs...', 'warn'); const urlPattern = /https:\/\/belabeu-e7061ee8ef78\.herokuapp\.com\/[a-z0-9\/\-_?=&]+/gi; const allUrls = html.match(urlPattern) || []; if (allUrls.length > 0) { debugLog(`Found ${allUrls.length} raw URLs in the response`, 'info'); console.log('All URLs found:', allUrls); // Ищем наиболее подходящий URL const relevantUrl = allUrls.find(url => url.includes('/room/') || url.includes('/join/') || url.includes('SessionStartLinks') ); if (relevantUrl) { debugLog(`Found potentially relevant URL: ${relevantUrl}`, 'success'); return relevantUrl; } } return null; } catch (error) { debugLog(`Error while extracting session link: ${error.message}`, 'error'); console.error('Extract session link error details:', error); return null; } } // Функция для получения сессионной ссылки через XMLHttpRequest function getSessionLinkXHR() { return new Promise((resolve, reject) => { debugLog('Starting XMLHttpRequest to oTree server...', 'info'); const xhr = new XMLHttpRequest(); xhr.open('GET', 'https://belabeu-e7061ee8ef78.herokuapp.com/demo/dsst?test=1', true); xhr.withCredentials = true; // Включаем передачу куки для CORS // Добавляем заголовки для имитации браузера и повышения шансов на успех debugLog('Setting up XHR headers...', 'info'); xhr.setRequestHeader('Accept', 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8'); xhr.setRequestHeader('Accept-Language', 'en-US,en;q=0.5'); xhr.setRequestHeader('Cache-Control', 'no-cache'); xhr.setRequestHeader('Pragma', 'no-cache'); console.log('XHR Request headers:', { 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8', 'Accept-Language': 'en-US,en;q=0.5', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache' }); xhr.onreadystatechange = function() { debugLog(`XHR readyState changed: ${xhr.readyState}`, 'info'); if (xhr.readyState === 2) { debugLog(`XHR headers received, status: ${xhr.status}`, 'info'); } if (xhr.readyState === 4) { if (xhr.status >= 200 && xhr.status < 300) { debugLog(`XHR request successful: ${xhr.status} ${xhr.statusText}`, 'success'); // Проверяем тип содержимого const contentType = xhr.getResponseHeader('Content-Type'); debugLog(`Response Content-Type: ${contentType}`, 'info'); // Выводим все заголовки ответа debugLog('Response headers:', 'info'); const headers = xhr.getAllResponseHeaders(); console.log('XHR Response headers:', headers); // Проверяем заголовки CORS const corsHeaders = { 'Access-Control-Allow-Origin': xhr.getResponseHeader('Access-Control-Allow-Origin'), 'Access-Control-Allow-Credentials': xhr.getResponseHeader('Access-Control-Allow-Credentials'), 'Access-Control-Allow-Methods': xhr.getResponseHeader('Access-Control-Allow-Methods') }; debugLog('CORS headers in response:', 'info'); console.table(corsHeaders); // Извлекаем ссылку из ответа const responseText = xhr.responseText; debugLog(`Response length: ${responseText.length} characters`, 'info'); const sessionLink = extractSessionLink(responseText); if (sessionLink) { debugLog(`Successfully extracted session link: ${sessionLink}`, 'success'); resolve(sessionLink); } else { debugLog('Failed to extract session link from response', 'warn'); reject(new Error('Could not find session link in the response')); } } else { debugLog(`XHR request failed: ${xhr.status} ${xhr.statusText}`, 'error'); console.error('XHR Error details:', { status: xhr.status, statusText: xhr.statusText, responseType: xhr.responseType, responseURL: xhr.responseURL }); reject(new Error(`Server responded with status ${xhr.status}`)); } } }; xhr.onerror = function() { debugLog('XHR network error occurred. This could be a CORS issue.', 'error'); console.error('XHR network error - possible CORS issue'); debugLog('Checking browser CORS settings...', 'info'); debugLog('Origin: ' + window.location.origin, 'info'); reject(new Error('Network error while connecting to oTree server')); }; xhr.onabort = function() { debugLog('XHR request was aborted', 'warn'); reject(new Error('Request was aborted')); }; xhr.timeout = 30000; // 30 секунд таймаут xhr.ontimeout = function() { debugLog('XHR request timeout', 'error'); reject(new Error('Request timeout')); }; try { debugLog('Sending XHR request...', 'info'); xhr.send(); } catch (error) { debugLog(`Error sending XHR request: ${error.message}`, 'error'); console.error('XHR send error:', error); reject(error); } }); } // Функция для получения сессионной ссылки через Fetch API function getSessionLinkFetch() { debugLog('Starting Fetch request to oTree server...', 'info'); // Заголовки запроса const headers = { 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8', 'Accept-Language': 'en-US,en;q=0.5', 'Connection': 'keep-alive', 'Upgrade-Insecure-Requests': '1', 'Cache-Control': 'no-cache', 'Pragma': 'no-cache' }; debugLog('Fetch request headers:', 'info'); console.table(headers); return fetch('https://belabeu-e7061ee8ef78.herokuapp.com/demo/dsst?test=1', { method: 'GET', credentials: 'include', // Включаем передачу куки mode: 'cors', // Явно указываем режим CORS headers: headers }) .then(response => { debugLog(`Fetch response received: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error'); // Проверяем и выводим URL ответа debugLog(`Response URL: ${response.url}`, 'info'); // Проверяем заголовки ответа debugLog('Response headers:', 'info'); const responseHeaders = {}; response.headers.forEach((value, name) => { responseHeaders[name] = value; debugLog(`Response header ${name}: ${value}`, 'info'); }); console.table(responseHeaders); // Специально проверяем CORS заголовки const corsHeaders = { 'access-control-allow-origin': response.headers.get('access-control-allow-origin'), 'access-control-allow-credentials': response.headers.get('access-control-allow-credentials'), 'access-control-allow-methods': response.headers.get('access-control-allow-methods') }; debugLog('CORS headers in Fetch response:', 'info'); console.table(corsHeaders); if (!response.ok) { throw new Error(`Server responded with status ${response.status}`); } debugLog('Getting response text...', 'info'); return response.text(); }) .then(html => { debugLog(`Fetch response text received, length: ${html.length} characters`, 'success'); // Извлекаем ссылку на сессию const sessionLink = extractSessionLink(html); if (sessionLink) { debugLog(`Successfully extracted session link: ${sessionLink}`, 'success'); return sessionLink; } else { debugLog('Failed to extract session link from response', 'warn'); throw new Error('Could not find session link in the response'); } }) .catch(error => { debugLog(`Fetch error: ${error.message}`, 'error'); console.error('Fetch error details:', error); throw error; }); } // Главная функция для получения ссылки на эксперимент async function getExperimentLink() { // Сбрасываем сообщение об ошибке document.getElementById('error-message').style.display = 'none'; // Обновляем статус updateStatus('Requesting new session from oTree server...', true); try { debugLog('Starting experiment link generation process...'); // Сначала пробуем XMLHttpRequest как более надежный метод try { debugLog('Trying XMLHttpRequest method first...'); const sessionLink = await getSessionLinkXHR(); return sessionLink; } catch (xhrError) { debugLog(`XMLHttpRequest method failed: ${xhrError.message}`, 'warn'); // Если не сработал XMLHttpRequest, пробуем Fetch API debugLog('Trying Fetch API as fallback...'); try { const sessionLink = await getSessionLinkFetch(); return sessionLink; } catch (fetchError) { debugLog(`Fetch API method also failed: ${fetchError.message}`, 'error'); throw new Error('Both request methods failed. CORS might be blocking access.'); } } } catch (error) { debugLog(`Error in getExperimentLink: ${error.message}`, 'error'); updateStatus('Failed to get experiment link'); showError(`Error: ${error.message}. Please try again or check the debug panel.`); throw error; } } // Функция для скачивания журнала отладки function downloadDebugLogs() { debugLog('Preparing debug logs for download...', 'info'); try { // Собираем все логи в один текст const logText = debugLines.join('\n'); // Добавляем дополнительную информацию о странице const browserInfo = ` --------- BROWSER INFORMATION --------- User Agent: ${navigator.userAgent} Platform: ${navigator.platform} Language: ${navigator.language} Cookie Enabled: ${navigator.cookieEnabled} Window Size: ${window.innerWidth}x${window.innerHeight} URL: ${window.location.href} Origin: ${window.location.origin} --------- END BROWSER INFO --------- `; const fullLogText = browserInfo + logText; // Создаем Blob с текстом const blob = new Blob([fullLogText], { type: 'text/plain' }); // Создаем ссылку для скачивания const link = document.createElement('a'); link.href = URL.createObjectURL(blob); // Устанавливаем имя файла с датой и временем const now = new Date(); const timestamp = now.toISOString().replace(/[:.]/g, '-'); link.download = `otree-debug-logs-${timestamp}.txt`; // Добавляем ссылку в документ, нажимаем и удаляем document.body.appendChild(link); link.click(); document.body.removeChild(link); debugLog('Debug logs downloaded successfully', 'success'); } catch (error) { debugLog(`Error downloading debug logs: ${error.message}`, 'error'); console.error('Download logs error:', error); } } // Функция для очистки журнала отладки function clearDebugLogs() { debugLog('Clearing debug logs...', 'info'); // Очищаем массив логов debugLines = []; // Обновляем отображение const debugOutput = document.getElementById('debug-output'); if (debugOutput) { debugOutput.textContent = '// Logs cleared. New debug information will appear here.'; } debugLog('Debug logs cleared', 'info'); } // Добавляем обработчики событий после полной загрузки DOM document.addEventListener('DOMContentLoaded', function() { debugLog('DOM fully loaded, initializing event handlers'); try { // Кнопка генерации ссылки на эксперимент const generateButton = document.getElementById('generate-button'); generateButton.addEventListener('click', async function() { debugLog('Generate button clicked'); try { // Сбрасываем интерфейс document.getElementById('link-container').style.display = 'none'; document.getElementById('experiment-iframe').style.display = 'none'; document.getElementById('error-message').style.display = 'none'; // Получаем ссылку на эксперимент const sessionLink = await getExperimentLink(); if (sessionLink) { // Обновляем интерфейс с ссылкой updateStatus('Session link generated successfully!'); document.getElementById('session-link').href = sessionLink; document.getElementById('session-link').textContent = sessionLink; document.getElementById('link-container').style.display = 'block'; // Кнопка открытия в новой вкладке document.getElementById('open-session').onclick = function() { debugLog(`Opening session in new tab: ${sessionLink}`); window.open(sessionLink, '_blank'); }; // Кнопка загрузки в iframe document.getElementById('embed-session').onclick = function() { debugLog(`Loading session in iframe: ${sessionLink}`); const iframe = document.getElementById('experiment-iframe'); iframe.src = sessionLink; iframe.style.display = 'block'; }; } else { throw new Error('Failed to generate session link'); } } catch (error) { showError(`Error: ${error.message}`); updateStatus('Failed to generate session link'); } }); // Кнопка переключения отладочной панели const toggleDebugButton = document.getElementById('toggle-debug'); toggleDebugButton.addEventListener('click', function() { const debugPanel = document.getElementById('debug-panel'); if (debugPanel.style.display === 'block') { debugPanel.style.display = 'none'; toggleDebugButton.textContent = 'Show Debug Information'; } else { debugPanel.style.display = 'block'; toggleDebugButton.textContent = 'Hide Debug Information'; } }); // Тестовая кнопка для XMLHttpRequest document.getElementById('xhr-test').addEventListener('click', async function() { debugLog('Testing XMLHttpRequest...'); try { const link = await getSessionLinkXHR(); debugLog(`XHR Test Result: ${link}`, 'info'); } catch (error) { debugLog(`XHR Test Failed: ${error.message}`, 'error'); } }); // Тестовая кнопка для Fetch API document.getElementById('fetch-test').addEventListener('click', async function() { debugLog('Testing Fetch API...'); try { const link = await getSessionLinkFetch(); debugLog(`Fetch Test Result: ${link}`, 'info'); } catch (error) { debugLog(`Fetch Test Failed: ${error.message}`, 'error'); } }); // Кнопка скачивания логов document.getElementById('download-logs').addEventListener('click', function() { downloadDebugLogs(); }); // Кнопка очистки логов document.getElementById('clear-logs').addEventListener('click', function() { clearDebugLogs(); }); debugLog('All event handlers initialized successfully'); updateStatus('Ready to generate experiment link'); // Для совместимости с поиском в консоли window.getExperimentLink = getExperimentLink; window.getSessionLinkXHR = getSessionLinkXHR; window.getSessionLinkFetch = getSessionLinkFetch; window.extractSessionLink = extractSessionLink; window.debugLog = debugLog; window.downloadDebugLogs = downloadDebugLogs; window.clearDebugLogs = clearDebugLogs; } catch (error) { console.error('Error initializing event handlers:', error); debugLog(`Error initializing page: ${error.message}`, 'error'); } }); </script></section><footer class="page__meta"></footer></div></article></div><!--<div class="page__footer-follow"><ul class="social-icons"><li><strong>Follow:</strong></li><li><a href="http://github.com/gregory-ch"><i class="fab fa-github" aria-hidden="true"></i> GitHub</a></li><li><a href="https://gregory-ch.github.io/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li></ul></div><div class="page__footer-copyright">&copy; 2025 Chernov Gregory. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/academicpages/academicpages.github.io">AcademicPages</a>, a fork of <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>--> <script src="https://gregory-ch.github.io/assets/js/main.min.js"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', '', 'auto'); ga('send', 'pageview'); </script></body></html>
